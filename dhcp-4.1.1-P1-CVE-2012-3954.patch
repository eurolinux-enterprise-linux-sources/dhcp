diff -up dhcp-4.1.1-P1/common/options.c.CVE-2012-3954 dhcp-4.1.1-P1/common/options.c
--- dhcp-4.1.1-P1/common/options.c.CVE-2012-3954	2012-07-25 11:59:43.000000000 +0200
+++ dhcp-4.1.1-P1/common/options.c	2012-07-25 12:00:57.957628118 +0200
@@ -2398,6 +2398,8 @@ prepare_option_buffer(struct universe *u
 
 	/* And let go of our references. */
       cleanup:
+	if (lbp != NULL)
+		buffer_dereference(&lbp, MDL);
 	option_dereference(&option, MDL);
 
 	return 1;
diff -up dhcp-4.1.1-P1/server/dhcpv6.c.CVE-2012-3954 dhcp-4.1.1-P1/server/dhcpv6.c
--- dhcp-4.1.1-P1/server/dhcpv6.c.CVE-2012-3954	2012-07-25 11:59:43.479667604 +0200
+++ dhcp-4.1.1-P1/server/dhcpv6.c	2012-07-25 12:02:39.552224739 +0200
@@ -1284,6 +1284,8 @@ lease_to_client(struct data_string *repl
 	struct data_string packet_oro;
 	isc_boolean_t no_resources_avail;
 
+	memset(&packet_oro, 0, sizeof(packet_oro));
+
 	/* Locate the client.  */
 	if (shared_network_from_packet6(&reply.shared,
 					packet) != ISC_R_SUCCESS)
@@ -1306,7 +1308,6 @@ lease_to_client(struct data_string *repl
 	 * Get the ORO from the packet, if any.
 	 */
 	oc = lookup_option(&dhcpv6_universe, packet->options, D6O_ORO);
-	memset(&packet_oro, 0, sizeof(packet_oro));
 	if (oc != NULL) {
 		if (!evaluate_option_cache(&packet_oro, packet, 
 					   NULL, NULL, 
@@ -1615,6 +1616,8 @@ lease_to_client(struct data_string *repl
 		packet_dereference(&reply.packet, MDL);
 	if (reply.client_id.data != NULL)
 		data_string_forget(&reply.client_id, MDL);
+	if (packet_oro.buffer != NULL)
+		data_string_forget(&packet_oro, MDL);
 	reply.renew = reply.rebind = reply.prefer = reply.valid = 0;
 	reply.cursor = 0;
 }
